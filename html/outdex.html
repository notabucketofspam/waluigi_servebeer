<!DOCTYPE html>
<html>
<head>
<title>outdex steakzone - waluigi-servebeer.com</title>
<link rel="stylesheet" type="text/css" href="/css/great-scott.css">
<meta name="viewport" content="width=640, initial-scale=1"/>
<style>
  .getitouttahere {
  display: none;
  }
  #label-for-cowbox {
    font-style: italic;
  }
  #cowbox {
  height: 10px;
  }
  #cowbox {
    accent-color:red;
  }
  #hoverboots {
  margin-left: 40px;
  position: fixed;
  margin-top: -10px;
  }
</style>
</head>
<body>
  <div id="hoverboots">
    <span>only the highest-quality meats are selected for serving on waluigi-servebeer.com</span>
    <br />
    <button id="quit">quit</button>
    <input id="cowbox" type="checkbox" /><label id="label-for-cowbox" for="cowbox">show cowtools?</label>
    <span id="cowtools" class="getitouttahere">
      <button id="button">bread</button>
      <button id="ick">wolfjerkey&#8482;</button>
      <button id="meateater">meateater</button>
      <button id="eatmeter">eatmeter</button>
      <input id="meeptheater" type="url" placeholder="meeptheater" />
      <button id="meeper">meeper</button>
    </span>
  </div>
<main></main>
<script src="/js/everything.js"></script>
<script>
  /**@type HTMLDivElement */
  var top_steak = document.getElementById("steak_corner");
  var startup_done = true;
  hashgrab();
var main = document.querySelector('main');
var button = document.getElementById("button");
  var ick = document.getElementById("ick");
  var meateater = document.getElementById("meateater");
  var eatmeter = document.getElementById("eatmeter");
  var meeper = document.getElementById("meeper");
/**@type HTMLInputElement*/
var meeptheater = document.getElementById("meeptheater");
var quit = document.getElementById("quit");
  var bread = /(?<title>\<title\>.*?\<\/title\>)|(?:(?<=\<style\>)(?<glitter>.*?)(?=\<\/style\>))|(?<lonk>\<link.*?\>)|(?:(?<=\<script\>)(?<soup>.*?)(?=\<\/script\>))|(?<src>\<script src=".*?"\>\<\/script\>)/gs;
  var newtext = "";
  /**@type HTMLInputElement*/
  var cowbox = document.getElementById('cowbox');
  var cowtools = document.getElementById('cowtools');
  var labelForCowbox = document.getElementById('label-for-cowbox');
  /**
   * put those almonds to good use
   * @param {string} url the page you need
   */
function consume(url) {
  if (url.includes("outdex.html")) {
      quit_more();
    return;
  }
  unprepare_almonds();
  fetch(url)
    .then(res => res.text())
    .then(restext => {
      main.replaceChildren();
      newtext = restext.replaceAll(bread, function replacer(substring, ...args) {
          const groups = args.at(-1);
        if (typeof groups === 'object') {
          if (groups.glitter) {
            const style = document.createElement('style');
            style.innerHTML = groups.glitter;
            main.prepend(style);
          }
          if (groups.soup) {
            setTimeout(() => {
                const script = document.createElement('script');
                script.innerHTML = groups.soup;
                main.prepend(script);
              }, 0);
          }
          if (groups.title) {
            // im too lazy to fix the regexp lol
            if (groups.title.length > 36)
              document.title = groups.title.slice(7, -8);
            else
              document.title = "waluigi-servebeer.com";
            document.title += " (outdex steakzone)";
            }
            if (groups.lonk) {
            }
        }
        return "";
      });
      main.insertAdjacentHTML('beforeend', newtext);
      prepare_almonds();
            if (document.getElementById('fixed_top')) {
        top_steak.classList.add('getitouttahere');
      } else {
        top_steak.classList.remove('getitouttahere');
      }
    });

  }
  cowbox.addEventListener('change', ev => {
    cowtools.classList.toggle('getitouttahere');
    labelForCowbox.classList.toggle('getitouttahere');
  });
button.addEventListener("click", ev => {
  consume("/index.html");
});
ick.addEventListener("click", ev => {
  consume("/page/meat-substrate/meat.html");
  });
  /**greedy lil thief*/
  function hashgrab() {
    const hash = location.hash.substring(1);
    if (hash) {
      consume(hash);
    } else {
      consume("/");
    }
  }
  meateater.addEventListener('click', hashgrab);

  function unprepare_almonds() {
    const allah = document.querySelectorAll("a");
    for (const a of allah) {
      a.removeEventListener('click', dubiousLink);
    }
  }
  function prepare_almonds() {
    const allah = document.querySelectorAll("a");
    for (const a of allah) {
      a.addEventListener('click', dubiousLink);
    }
  }
  /**@param {MouseEvent}ev*/
  function dubiousLink(ev) {
    ev.preventDefault();
  /**@type HTMLAnchorElement*/
    const a = ev.composedPath().find(el => el instanceof HTMLAnchorElement);
    const pn = a.pathname;
    location.hash = pn;
    consume(pn);
  }
  eatmeter.addEventListener('click', ev => {
      document.body.style.backgroundColor = `oklch(${Math.random()} ${Math.random() / 2} ${Math.random()}turn)`;
  });

  function donatehash() {
    let valproate = meeptheater.value;
    if (valproate) {
      location.hash = valproate;
      consume(valproate);
    }
  }
  meeper.addEventListener('click', donatehash);

  quit.addEventListener("click", ev => quit_more());
  function quit_more() {
    //   alert("The door is closed.");
      prompt("Headin' back to Sydney, bruv?", "S\xED");
      location.assign("/");
      return;
  }
</script>
</body>
</html>
