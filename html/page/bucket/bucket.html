<!DOCTYPE html>

<style>
  .path_button {
    width: 100%;
    text-align: left;
    outline: none;
    background-color: #eeeeee;
    font-size: 24px;
    padding: 8px 0px 8px 8px;
    cursor: pointer;
    border-style: solid;
    border-width: 2px;
    border-color: #000000;
    overflow: hidden;
    margin: -2px 0px 0px 0px;
  }
  .path_button:hover {
    text-decoration: underline;
  }
  .path_button:hover, .path_button_active { 
    background-color: #cccccc;
  }
  .path_div {
    margin-left: 24px;
  }
  .bucketmap_anchor {
    font-size: 20px;
    padding: 2px 0px 4px 0px;
    border-style: solid;
    border-width: 0px 0px 0px 2px;
    border-color: #000000;
    text-decoration: none;
    color: #000000;
    white-space: nowrap;
  }
  .bucketmap_anchor:hover {
    text-decoration: underline;
  }
  #bucketmap {
    background-color: #eeeeee;
  }
</style>

<html>
  <head>
    <title>Bucket - waluigi-servebeer.com</title>
    <!-- <link rel="icon" type="image/png" href="favicon-bucket.png"/> -->
    <link rel="stylesheet" type="text/css" 
      href="/css/general-style-f7ccc957cab8e1c9b8ddac5214e270b70a08fbf3f8b9d67f61b3a44e38fd96cc.css"/>
    <link rel="stylesheet" type="text/css" 
      href="/css/dropdown-menu-0fd860a6b3da754c857b107092c80ddd32dc99b1897a47b917ec7d8aeb476b17.css"/>
    <meta name="viewport" content="width=640, initial-scale=1"/>
  </head>
  <body>
    <br>
    <h1>spam-can-prime</h1>
    <h2>S3 object storage bucket</h2>
    <div id="bucketmap">
    </div>
  </body>
</html>

<script src="/js/general-script-e38ad4f976fc007b4c83298e24422d43132052e6a4f6284111c769b7fc8e21a0.js"></script>
<script src="/js/async-load-06e580bf736ecfeb785447aece8f05de9fd494615f828ef7783b562b8b758863.js"></script>
<script src="/js/startup-common-15665d71133de1ea364aaeea8abd6119e338017da9f52a2ec1d0bf26d782e47c.js"></script>
<script>
  // dm me if endpoint link is broken: @not.a.bucket.of.spam#0296
  const bucket_endpoint = "https://spam-can-prime.s3.fr-par.scw.cloud";
  (function() {
    startup_common();
    async_data_request(
      {data_path: "/page/bucket/bucketmap.txt", request_header: "Cache-Control: no-store"}, 
      function(xhr) {generate_bucketmap(xhr);}
    );
  })();
  function generate_bucketmap(xhr) {
    let bucketmap_arr = xhr.responseText.split(/\n/);
    let bucketmap_element = document.getElementById("bucketmap");
    bucketmap_arr.forEach(element => {
      let element_path_arr = element.split("/").slice(2, (element.split("/").length - 1)); // testing: slice(1, ...)
      let path_index;
      for (path_index = 0; path_index < element_path_arr.length; ++path_index) {
        let path_subpath_inc = element_path_arr.slice(0, path_index + 1).join("/");
        let path_subpath_inc_element = document.getElementById(path_subpath_inc);
        let path_subpath_exc = element_path_arr.slice(0, path_index).join("/");
        let path_subpath_exc_element = document.getElementById(path_subpath_exc);
        // create directory
        if (!path_subpath_inc_element) {
          // create path button
          let path_button = document.createElement("button");
          let path_button_attr_class = document.createAttribute("class");
          path_button_attr_class.value = "path_button";
          path_button.setAttributeNode(path_button_attr_class);
          let path_button_attr_onclick = document.createAttribute("onclick");
          path_button_attr_onclick.value = `toggle_path_div_display(this, "${path_subpath_inc}")`;
          path_button.setAttributeNode(path_button_attr_onclick);
          path_button.innerText = element_path_arr[path_index];
          // create div
          let path_div = document.createElement("div");
          let path_div_attr_id = document.createAttribute("id");
          path_div_attr_id.value = path_subpath_inc;
          path_div.setAttributeNode(path_div_attr_id);
          let path_div_attr_style = document.createAttribute("style");
          path_div_attr_style.value = "display: none;";
          path_div.setAttributeNode(path_div_attr_style);
          let path_div_attr_class = document.createAttribute("class");
          path_div_attr_class.value = "path_div";
          path_div.setAttributeNode(path_div_attr_class);
          // append directory to document
          if (!path_subpath_exc_element) {
            bucketmap_element.appendChild(path_button);
            bucketmap_element.appendChild(path_div);
          } else {
            path_subpath_exc_element.appendChild(path_button);
            path_subpath_exc_element.appendChild(path_div);
          }
          path_subpath_inc_element = path_div;
        }
        // append anchor to directory
        if (path_subpath_inc_element && path_subpath_inc == element_path_arr.join("/")) {
          let bucketmap_anchor = document.createElement("a");
          let bucketmap_anchor_attr_href = document.createAttribute("href");
          bucketmap_anchor_attr_href.value = bucket_endpoint + encodeURIComponent(element).replace(/%2F/g, "/");
          bucketmap_anchor.setAttributeNode(bucketmap_anchor_attr_href);
          bucketmap_anchor.innerHTML = element.split("/")[element.split("/").length - 1];
          let bucketmap_anchor_attr_class = document.createAttribute("class");
          bucketmap_anchor_attr_class.value = "bucketmap_anchor";
          bucketmap_anchor.setAttributeNode(bucketmap_anchor_attr_class);
          let bucketmap_anchor_attr_data_path = document.createAttribute("data-path");
          bucketmap_anchor_attr_data_path.value = path_subpath_inc;
          let bucketmap_anchor_attr_target = document.createAttribute("target");
          bucketmap_anchor_attr_target.value = "_blank";
          bucketmap_anchor.setAttributeNode(bucketmap_anchor_attr_target);
          bucketmap_anchor.setAttributeNode(bucketmap_anchor_attr_data_path);
          path_subpath_inc_element.appendChild(bucketmap_anchor);
          let bucketmap_br = document.createElement("br");
          path_subpath_inc_element.appendChild(bucketmap_br);
        }
      }
    });
  }
  function toggle_path_div_display(path_button, path_subpath_inc) {
    path_button.classList.toggle("path_button_active");
    let path_div = document.getElementById(path_subpath_inc); 
    path_div.style.display = path_div.style.display === "block" ? "none" : "block";
  }
</script>
