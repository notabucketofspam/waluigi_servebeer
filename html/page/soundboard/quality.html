<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="/css/great-scott.css"/>
<meta name="viewport" content="width=device-width, user-scalable=yes"/>
<title>Soundboard - waluigi-servebeer.com</title>
<style>
:root{
  --how-many-buttons: 5;
}
@media (max-width:600px){
  :root{
    --how-many-buttons: 3;
  }
  #local_volume, #username_perchance{
    float:none;
  }
}
#username_perchance{
  margin-right: 1in;
  max-width:3in;
}
details.sb#love_zone>summary>h2{
  position:relative;
  margin-bottom:18px;
}
#love_zone[open]{
  min-height:8.1lh;
}
#love_zone>summary{
  color:red;
}
:where(#booba,#love_zone) button, textarea.lovesec {
  margin:2px;
  position:relative;
}
#topstuff{
  text-align:center;
}
#topstuff>h1{
  margin:0;
  font-size:2.5rem;
}
input{
  accent-color:red;
}
div.sef.lard *{
  user-select:none;
}
#greatanswer{
  margin:0;
  position:absolute;
}
#where_help{
  font-size:xx-small;
  padding:1px 3.5px;
  cursor:help;
}
div#how2love{
  position:absolute;
  font-size:initial;
}
button.loved::before{
  content:"<3";
  position:absolute;
  color:white;
  background-color:red;
  font-weight:bold;
  transform:rotate(270deg);
  left:4px;
  top:33%;
  font-size:1lh;
}
.sounds {
  display: grid;
  grid: auto-flow 3lh / repeat(var(--how-many-buttons), 1fr);
}
textarea.lovesec{
  grid-column-start:1;
  border:1px solid black;
  resize:none;
  align-content:center;
  text-align:center;
  background-color:#fffa;
}
:where(details).sb[open]{
  margin-bottom:10px;
}
:where(details,div).sb>summary>h2{
  display:inline-block;
  margin:4px 0px;
  font-size:2rem;
}
:where(details,div).sb>summary{
  --max-width:fit-content;
}
details.sb summary:hover{
  h2{
    text-decoration:wavy underline 1px;
  }
}
.sb h3{
  margin:0;
  max-width:fit-content;
}
@media (max-width:400px){
  #clockbot_zone>div.fr{
    float:none;
  }
}
#clockbot_zone{
  margin-bottom:25px;
}
div#arm_nuke_display{
  z-index:5;
  aspect-ratio:1;
  background-color:white;
  border:2px solid black;
  width:190px;
  position:fixed;
  left:calc(50vw - 95px);
  top:25%;
  text-align:center;
  padding:6px;
  align-content:center;  
  pointer-events:none;
  user-select:none;
}
div#arm_nuke_display>div{
  font-size:larger;
  font-variant:small-caps;
}
div#arm_nuke_display>button{
  pointer-events:none;
  user-select:none;
}
div#arm_nuke_display>meter{
  width:100%;
}
</style>
</head>
<body>
<div hidden id="arm_nuke_display">
  <div>Press Both</div>
  <button><b>&#x1F5D1;&#xFE0F;</b> nuke</button>
  <div>To Finalize Nuke</div>
  <br/>
  <div>Time Remaining: <span id="arm_nuke_timer">5.00</span></div>
  <meter id="arm_nuke_meter" min="0" max="5000" low="1500" high="3500" optimum="5000" value="5000"></meter>
</div>
<div class="sef lard">

  <div id="topstuff">
    <h1>Soundboard</h1>
  </div>
  
  <div id="clockbot_zone" class="sb">
    <summary><h2>Controls</h2></summary>
    
    <div id="local_volume" style="text-align:center" class="lube fr">
      <h3 style="justify-self:center;">Local Volume</h3>
      <div><input id="somevolume" type="range" step="any" min="0" max="1" value="0.0" oninput="setgain(this.valueAsNumber)"/></div>
      <div><span style="font-size:78%;font-family:monospace;font-weight:bold;">(doesn't affect ClockBot)</span></div>
    </div>
    
    <div id="username_perchance" class="lube fr">Not logged in</div>
    
    <div style="position:relative" class="lube">
      <div>
        <h3>ClockBot</h3>
        <div>
          <label><input type="checkbox" id="clockbot_enable"/>Enable</label>
          <a href="https://discord.com/oauth2/authorize?client_id=821257635973169193" target="_blank" style="display:inline-block;margin-left:68px;">Install</a>
        </div>
        <div>
          <input type="text" placeholder="Channel ID" id="channel_id" value=""/>
          <button id="where_help" popovertarget="greatanswer">where?</button>
        </div>
        <div>
          <button onclick="getinchat()">get in chat</button>
          <button onclick="leave_chat()">leave chat</button>
        </div>
      </div>
        <dialog id="greatanswer" popover>
          <div>Where's Channel ID? Great question! So...</div>
          <ol style="margin:0">
            <li>Go to &#x26ED;User Settings &rArr; App Settings &ndash; Advanced</li>
            <li>Flip the <b>Developer Mode</b> switch to the <b>on</b> position</li>
            <li>Right-click on a voice channel</li>
            <li><b>Copy Channel ID</b> is at the bottom of the context menu</li>
          </ol>
        </dialog>
    </div>
  </div>
  
  <details id="love_zone" class="sb">
    <summary>
      <h2>
        The Sounds You Love
        <div id="how2love">You can love them with right-click</div>
      </h2>
    </summary>
    <div>
      <button onclick="window.nuke_control.arm('L')"><b>&#x1F5D1;&#xFE0F;</b> nuke</button>
      <button onclick="kill_shelf()"><b>&#x2796;&#xFE0F;</b> kill shelf</button>
      <button onclick="add_shelf()"><b>&#x2795;&#xFE0F;</b> add shelf</button>
      <button onclick="window.nuke_control.arm('R')" style="float:right"><b>&#x1F5D1;&#xFE0F;</b> nuke</button>
    </div>
    <div id="love_children" class="sounds"></div>
  </details>  
  
  <div id="booba"></div>
</div>
</div>
<script src="/js/everything.js"></script>
<script src="/page/soundboard/opodes/boards.js"></script>
<script src="/page/soundboard/cacophony.js"></script>
<script>
document.getElementById('where_help').addEventListener('click', ev=>{
  var greatanswer = document.getElementById('greatanswer');
  greatanswer.style.left = ev.x+'px';
  greatanswer.style.top = ev.y+'px';
});

var kiddos = document.getElementById('love_children');
kiddos.addEventListener("dragover",ev=>ev.preventDefault());
kiddos.addEventListener("drop", lovelist_drop);

whichStorage["soundboard_gain"] ??= 0.20;
somevolume.value = whichStorage["soundboard_gain"];
setgain(whichStorage["soundboard_gain"]);

board.forEach(key=>make_group(booba, key));

function setgain(g){
  gainode.gain.setValueAtTime(g,0);
  whichStorage["soundboard_gain"] = g;
}

whichStorage["soundboard_clockbot_enable"] ??= 0;
clockbot_enable.checked = Number(whichStorage["soundboard_clockbot_enable"]);
clockbot_enable.addEventListener('input', (ev)=>{
  whichStorage["soundboard_clockbot_enable"] = Number(ev.target.checked);
  somevolume.disabled = ev.target.checked;
});
somevolume.disabled = clockbot_enable.checked;

whichStorage["soundboard_clockbot_channel_id"] ??= "";
channel_id.value = whichStorage["soundboard_clockbot_channel_id"];
channel_id.addEventListener('input', (ev)=>{
  whichStorage["soundboard_clockbot_channel_id"] = ev.target.value;
});

write_lovelist();

setTimeout(setup_open);
var has_username = false;
check_online(dat=>{
  if (dat.username){
    var username_perchance = document.getElementById("username_perchance")
    username_perchance.innerHTML = "Logged in as <em>"+dat.username+"</em>";
    has_username = true;
    get_love();
  }
});
</script>
</body>
</html>
